fun saveImageToGallery(context: Context, file: File?) {
    file?.let {
        val filename = file.name
        val mimeType = "image/jpeg"
        val values = ContentValues().apply {
            put(MediaStore.Images.Media.DISPLAY_NAME, filename)
            put(MediaStore.Images.Media.MIME_TYPE, mimeType)
            put(MediaStore.Images.Media.RELATIVE_PATH, Environment.DIRECTORY_PICTURES)
        }

        val resolver = context.contentResolver
        val uri = resolver.insert(MediaStore.Images.Media.EXTERNAL_CONTENT_URI, values)
        
        uri?.let {
            val outputStream: OutputStream? = resolver.openOutputStream(uri)
            val inputStream = FileInputStream(file)

            try {
                inputStream.copyTo(outputStream!!)
            } catch (e: Exception) {
                e.printStackTrace()
            } finally {
                inputStream.close()
                outputStream?.close()
            }
        }
    }
}
